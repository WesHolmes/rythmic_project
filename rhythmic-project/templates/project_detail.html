{% extends "base.html" %}

{% block title %}{{ project.name }} - Rhythmic{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    <div class="mb-8">
        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
            <div>
                <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">
                    {{ project.name }}
                </h1>
                {% if project.description %}
                <p class="text-gray-400 text-lg">{{ project.description }}</p>
                {% endif %}
            </div>
            <div class="flex flex-col sm:flex-row gap-3">
                <a href="{{ url_for('new_task', project_id=project.id) }}" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold inline-flex items-center shadow-lg">
                    <i class="fas fa-plus mr-2"></i>Add Task
                </a>
                <a href="{{ url_for('edit_project', id=project.id) }}" class="glass text-white px-6 py-3 rounded-xl font-semibold inline-flex items-center hover:bg-white/10 transition-all duration-200">
                    <i class="fas fa-edit mr-2"></i>Edit Project
                </a>
            </div>
        </div>
    </div>

    <!-- Project Actions -->
    <div class="mb-8 flex flex-wrap gap-4">
        <a href="{{ url_for('export_project', id=project.id) }}" class="glass text-green-400 px-6 py-3 rounded-xl font-medium inline-flex items-center hover:bg-green-500/10 transition-all duration-200">
            <i class="fas fa-download mr-2"></i>Export CSV
        </a>
        <a href="{{ url_for('import_project', id=project.id) }}" class="glass text-purple-400 px-6 py-3 rounded-xl font-medium inline-flex items-center hover:bg-purple-500/10 transition-all duration-200">
            <i class="fas fa-upload mr-2"></i>Import CSV
        </a>
        <button onclick="toggleTimelineView()" class="glass text-indigo-400 px-6 py-3 rounded-xl font-medium inline-flex items-center hover:bg-indigo-500/10 transition-all duration-200">
            <i class="fas fa-calendar-alt mr-2"></i>Timeline View
        </button>
    </div>

    <!-- Tasks List -->
    <div id="tasks-list" class="glass rounded-2xl overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-700">
            <h2 class="text-xl font-semibold text-white">Tasks ({{ tasks|length }})</h2>
        </div>
    
        {% if tasks %}
            <div class="divide-y divide-gray-700">
                {% for task in tasks %}
                <div class="px-6 py-4 hover:bg-gray-800/30 transition-colors duration-200">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="flex-shrink-0">
                                {% if task.status == 'completed' %}
                                    <i class="fas fa-check-circle text-green-400 text-xl"></i>
                                {% elif task.status == 'in_progress' %}
                                    <i class="fas fa-play-circle text-blue-400 text-xl"></i>
                                {% elif task.status == 'blocked' %}
                                    <i class="fas fa-exclamation-circle text-red-400 text-xl"></i>
                                {% else %}
                                    <i class="fas fa-circle text-gray-500 text-xl"></i>
                                {% endif %}
                            </div>
                            <div>
                                <h3 class="text-lg font-medium text-white">
                                    <a href="{{ url_for('edit_task', project_id=project.id, task_id=task.id) }}" class="hover:text-blue-400 transition-colors duration-200">
                                        {{ task.title }}
                                    </a>
                                </h3>
                                {% if task.description %}
                                <p class="text-gray-400 mt-1">{{ task.description[:100] }}{% if task.description|length > 100 %}...{% endif %}</p>
                                {% endif %}
                                <div class="flex items-center space-x-4 mt-3 text-sm">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium
                                        {% if task.priority == 'high' %}bg-red-500/20 text-red-400
                                        {% elif task.priority == 'medium' %}bg-yellow-500/20 text-yellow-400
                                        {% else %}bg-green-500/20 text-green-400{% endif %}">
                                        {{ task.priority.title() }}
                                    </span>
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium
                                        {% if task.size == 'large' %}bg-purple-500/20 text-purple-400
                                        {% elif task.size == 'medium' %}bg-blue-500/20 text-blue-400
                                        {% else %}bg-gray-500/20 text-gray-400{% endif %}">
                                        {{ task.size.title() }}
                                    </span>
                                    <span class="text-gray-500">{{ task.owner.name }}</span>
                                    {% if task.start_date %}
                                    <span class="text-gray-500">{{ task.start_date.strftime('%b %d') }}</span>
                                    {% endif %}
                                    {% if task.end_date %}
                                    <span class="text-gray-500">→ {{ task.end_date.strftime('%b %d') }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <form method="POST" action="{{ url_for('delete_task', project_id=project.id, task_id=task.id) }}" class="inline" onsubmit="return confirm('Are you sure you want to delete this task?')">
                                <button type="submit" class="text-gray-500 hover:text-red-400 p-2 rounded-lg hover:bg-red-500/10 transition-all duration-200">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="px-6 py-12 text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-gray-700 to-gray-800 rounded-2xl mb-6">
                    <i class="fas fa-tasks text-gray-400 text-2xl"></i>
                </div>
                <h3 class="text-xl font-semibold text-white mb-3">No tasks yet</h3>
                <p class="text-gray-400 mb-6">Start by adding your first task to this project</p>
                <a href="{{ url_for('new_task', project_id=project.id) }}" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold inline-flex items-center shadow-lg">
                    <i class="fas fa-plus mr-2"></i>Add First Task
                </a>
            </div>
        {% endif %}
    </div>

    <!-- Timeline View (Hidden by default) -->
    <div id="timeline-view" class="glass rounded-2xl mt-6" style="display: none;">
        <div class="px-6 py-4 border-b border-gray-700">
            <h2 class="text-xl font-semibold text-white">Timeline View</h2>
        </div>
        <div class="p-6">
            <div id="timeline-container" class="min-h-64">
                <!-- Timeline will be rendered here by JavaScript -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleTimelineView() {
    const tasksList = document.getElementById('tasks-list');
    const timelineView = document.getElementById('timeline-view');
    
    if (timelineView.style.display === 'none') {
        tasksList.style.display = 'none';
        timelineView.style.display = 'block';
        renderTimeline();
    } else {
        tasksList.style.display = 'block';
        timelineView.style.display = 'none';
    }
}

function renderTimeline() {
    const container = document.getElementById('timeline-container');
    const tasks = {{ tasks_data|tojson }};
    
    if (tasks.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center">No tasks to display in timeline</p>';
        return;
    }
    
    // Simple timeline rendering
    let timelineHTML = '<div class="space-y-4">';
    
    tasks.forEach(task => {
        const startDate = task.start_date ? new Date(task.start_date) : null;
        const endDate = task.end_date ? new Date(task.end_date) : null;
        
        timelineHTML += `
            <div class="flex items-center space-x-4 p-4 border border-gray-700 rounded-xl bg-gray-800/30">
                <div class="flex-shrink-0">
                    <div class="w-4 h-4 rounded-full ${getStatusColor(task.status)}"></div>
                </div>
                <div class="flex-1">
                    <h4 class="font-medium text-white">${task.title}</h4>
                    <div class="text-sm text-gray-400">
                        ${startDate ? startDate.toLocaleDateString() : 'No start date'} 
                        ${endDate ? ' → ' + endDate.toLocaleDateString() : ''}
                    </div>
                </div>
                <div class="text-sm text-gray-400">
                    ${task.priority} • ${task.size}
                </div>
            </div>
        `;
    });
    
    timelineHTML += '</div>';
    container.innerHTML = timelineHTML;
}

function getStatusColor(status) {
    switch(status) {
        case 'completed': return 'bg-green-400';
        case 'in_progress': return 'bg-blue-400';
        case 'blocked': return 'bg-red-400';
        default: return 'bg-gray-500';
    }
}
</script>
{% endblock %}
