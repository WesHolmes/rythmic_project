{% extends "base.html" %}

{% block title %}Project Invitation - Rhythmic{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center px-4">
    <div class="max-w-md w-full">
        <div class="glass rounded-2xl p-8 text-center">
            {% if invitation_valid %}
                <!-- Valid Invitation -->
                <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-share-alt text-white text-2xl"></i>
                </div>
                
                <h1 class="text-2xl font-bold text-white mb-2">You're Invited!</h1>
                <p class="text-gray-400 mb-6">
                    {{ inviter_name }} has invited you to collaborate on the project 
                    <span class="text-blue-400 font-semibold">{{ project_name }}</span>
                </p>

                <div class="bg-gray-800/50 rounded-lg p-4 mb-6">
                    <div class="flex items-center justify-center space-x-2 mb-2">
                        <i class="fas fa-user-shield text-{{ role_color }}-400"></i>
                        <span class="text-{{ role_color }}-400 font-semibold">{{ role.title() }} Access</span>
                    </div>
                    <p class="text-sm text-gray-400">{{ role_description }}</p>
                </div>

                {% if current_user.is_authenticated %}
                    <!-- User is logged in -->
                    <div class="space-y-3 mb-6">
                        <form method="POST" action="{{ url_for('process_sharing_invitation', token=token) }}">
                            <button type="submit" 
                                class="w-full btn-primary text-white px-6 py-3 rounded-xl font-semibold shadow-lg">
                                <i class="fas fa-check mr-2"></i>Accept Invitation
                            </button>
                        </form>
                        
                        <form method="POST" action="{{ url_for('decline_sharing_invitation', token=token) }}">
                            <button type="submit" 
                                class="w-full glass text-gray-300 px-6 py-3 rounded-xl font-semibold hover:bg-red-500/20 hover:text-red-300 transition-all duration-200">
                                <i class="fas fa-times mr-2"></i>Decline Invitation
                            </button>
                        </form>
                    </div>
                    
                    <p class="text-sm text-gray-500">
                        Responding as {{ current_user.name }} ({{ current_user.email }})
                    </p>
                {% else %}
                    <!-- User needs to log in or register -->
                    <div class="space-y-3 mb-6">
                        <a href="{{ url_for('login', next=request.url) }}" 
                            class="w-full btn-primary text-white px-6 py-3 rounded-xl font-semibold inline-block shadow-lg">
                            <i class="fas fa-sign-in-alt mr-2"></i>Sign In to Accept
                        </a>
                        
                        <a href="{{ url_for('register', next=request.url) }}" 
                            class="w-full glass text-white px-6 py-3 rounded-xl font-semibold inline-block hover:bg-white/10 transition-all duration-200">
                            <i class="fas fa-user-plus mr-2"></i>Create Account & Accept
                        </a>
                    </div>
                    
                    <p class="text-sm text-gray-500">
                        You'll need an account to collaborate on this project
                    </p>
                {% endif %}

                <!-- Invitation Details -->
                <div class="mt-8 pt-6 border-t border-gray-700">
                    <div class="flex items-center justify-between text-sm text-gray-500">
                        <span>Expires:</span>
                        <span>{{ expiry_date.strftime('%B %d, %Y at %I:%M %p') }}</span>
                    </div>
                    {% if max_uses > 1 %}
                    <div class="flex items-center justify-between text-sm text-gray-500 mt-2">
                        <span>Uses remaining:</span>
                        <span>{{ remaining_uses }} of {{ max_uses }}</span>
                    </div>
                    {% endif %}
                </div>

            {% else %}
                <!-- Invalid Invitation -->
                <div class="w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-exclamation-triangle text-red-400 text-2xl"></i>
                </div>
                
                <h1 class="text-2xl font-bold text-white mb-2">Invalid Invitation</h1>
                <p class="text-gray-400 mb-6">{{ error_message }}</p>

                <div class="space-y-3">
                    <a href="{{ url_for('projects') if current_user.is_authenticated else url_for('index') }}" 
                        class="w-full btn-primary text-white px-6 py-3 rounded-xl font-semibold inline-block shadow-lg">
                        <i class="fas fa-home mr-2"></i>Go to {{ 'Dashboard' if current_user.is_authenticated else 'Home' }}
                    </a>
                    
                    {% if not current_user.is_authenticated %}
                    <a href="{{ url_for('login') }}" 
                        class="w-full glass text-white px-6 py-3 rounded-xl font-semibold inline-block hover:bg-white/10 transition-all duration-200">
                        <i class="fas fa-sign-in-alt mr-2"></i>Sign In
                    </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>

        <!-- Help Text -->
        <div class="mt-6 text-center">
            <p class="text-sm text-gray-500">
                Need help? <a href="mailto:support@rhythmic.com" class="text-blue-400 hover:text-blue-300">Contact Support</a>
            </p>
        </div>
    </div>
</div>

<style>
/* Role-specific colors */
.text-owner-400 { color: #f87171; }
.text-admin-400 { color: #fb923c; }
.text-editor-400 { color: #60a5fa; }
.text-viewer-400 { color: #9ca3af; }

/* Invitation page specific styles */
.invitation-card {
    background: linear-gradient(135deg, rgba(31, 41, 55, 0.9) 0%, rgba(17, 24, 39, 0.9) 100%);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(75, 85, 99, 0.3);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.role-badge {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(147, 51, 234, 0.2) 100%);
    border: 1px solid rgba(59, 130, 246, 0.3);
}

/* Animation for invitation acceptance */
@keyframes acceptPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.btn-primary:hover {
    animation: acceptPulse 0.6s ease-in-out;
}
</style>
{% endblock %}